<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Prueba 0.1</title>
        <script src="three.min.js"></script>
        <script src="OrbitControls.js"></script>
        <script src="cannon.min.js"></script>
        
        <style>
            body {
                margin: 0px;
                overflow: hidden;
            }
        </style>
    </head>
    <body>
        <script>
            
            var WIDTH,
                HEIGHT,
                world,
                timeStep = 1/60,
                camera,
                renderer,
                controls;
            
            //Objects
            var ball, bodyBall;
            var board, bodyBoard;
            
            window.onload = () => {
                initThree();
                initCannon();
                animate();
            }
            
            function initThree() {
                WIDTH = window.innerWidth;
                HEIGHT = window.innerHeight;

                renderer = new THREE.WebGLRenderer({ antialias: true });
                renderer.setClearColor(0xbfd1e5);
                renderer.setSize(WIDTH, HEIGHT);
                document.body.appendChild(renderer.domElement);

                scene = new THREE.Scene();
                scene.background = new THREE.Color(0x00ac77);

                camera = new THREE.PerspectiveCamera(70, WIDTH/HEIGHT);
                camera.position.z = 70;
                scene.add(camera);

                var light = new THREE.AmbientLight(0xFFFFFF, 0.8);
                scene.add(light);

                var boardGeometry = new THREE.PlaneGeometry(30, 60);
                var boardMaterial = new THREE.MeshPhongMaterial({ color: 0xFF0000, side: THREE.DoubleSide });
                board = new THREE.Mesh(boardGeometry, boardMaterial);
                //board.rotation.x = -0.55;
                scene.add(board);

                var ballGeometry = new THREE.SphereGeometry(1, 20, 20);
                var ballMaterial = new THREE.MeshBasicMaterial({ color: 0xFFFF00 });
                ball = new THREE.Mesh(ballGeometry, ballMaterial);
                ball.position.set(0, 18, -23);
                scene.add(ball);
                
                

                controls = new THREE.OrbitControls(camera);
            }
            
            function initCannon() {
                world = new CANNON.World();
                world.gravity.set(0, -9.8, 0);
                world.broadphase = new CANNON.NaiveBroadphase();
                world.solver.iterations = 10;
                
                // Ball
                shape = new CANNON.Sphere(1);
                bodyBall = new CANNON.Body({ mass: 1 });
                bodyBall.position.set(0, 18, -23);
                bodyBall.addShape(shape);
                world.addBody(bodyBall);
                
                // Board
                shape = new CANNON.Plane();
                bodyBoard = new CANNON.Body({ mass: 0 });
                var axis = new CANNON.Vec3(1,0,0);
                var angle = Math.PI / 2;
                bodyBoard.quaternion.setFromAxisAngle(axis, angle);
                bodyBoard.addShape(shape);
                world.addBody(bodyBoard);
            }
            
        
            
            function animate() {
                requestAnimationFrame(animate);
                updatePhysics();
                renderer.render(scene, camera);
                controls.update();
            }
            
            function updatePhysics() {
                world.step(timeStep);                
                ball.position.copy(bodyBall.position);
                board.position.copy(bodyBoard.position);
                board.quaternion.copy(bodyBoard.quaternion);
            }
        
        </script>
    </body>
</html>